<?php
/**
 * @var CrimsonAgility\ProductsRange\Block\ProductsRange $block
 */
$text = $block->getText();
try {
    $currency = $block->getStoreCurrency();
} catch (\Magento\Framework\Exception\NoSuchEntityException $e) {
    $currency = "";
}
?>
<div class="row">
    <div class ="mp-col-md-8" >
        <div class = "row">
            <form method="post" action="" id="search-products-form"  data-hasrequired="<?= __('* Required Fields') ?>"
                  data-mage-init='{"validation":{}}'>
                <div class="field">
                    <label for="input1" class="label"><span><?php echo __('Low Price') ?></span></label>
                    <div class="control">
                        <input name="lowprice" id="input1" title="<?php echo __('Low price') ?>" value="" class="input-text" type="text" required>
                    </div>
                </div>
                <div class="field">
                    <label for="input2" class="label"><span><?php echo __('High Price') ?></span></label>
                    <div class="control">
                        <input name="highprice" id="input2" title="<?php echo __('High Price') ?>" value="" class="input-text" type="text" required>
                    </div>
                </div>
                <div class="field">
                    <label for="input3" class="label"><span><?php echo __('Sort By price') ?></span></label>
                    <div class="control">
                        <select name="sortoption" id="input3" title="sort" required>
                            <option value="asc">Ascending</option>
                            <option value="desc">Descending</option>
                        </select>
                    </div>
                </div>
                <div class="actions-toolbar">
                    <div class="primary">
                        <button type="button" class="action submit primary" id= "submit-btn" title="<?php echo __('Submit') ?>">
                            <span><?php echo __('Submit') ?></span>
                        </button>
                    </div>
                </div>
            </form>
        </div>
        <br/>
        <div class ="row">
            <div class="productlist">
                <h2>Products in range</h2>
                <div class="productlist-header">
                    <div class="productlist-col">Thumbnail</div>
                    <div class="productlist-col">SKU</div>
                    <div class="productlist-col">Name</div>
                    <div class="productlist-col">Quantity</div>
                    <div class="productlist-col">Price (<?=__($currency)?>)</div>
                    <div class="productlist-col">Product URL</div>
                </div>
                <div class="productlist-body" id="custom-tbody">
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    require(['jquery', 'jquery/ui'], function($){
        $('#submit-btn').click(function (event) {

           let lowerPrice = $('#input1').val();
           alert(lowerPrice);

            event.preventDefault();
            let form = $('#search-products-form');
            let formData = form.serialize();
            let actionUrl = 'https://m2clean.local/rest/V1/products/search';

            $.ajax({
                url: actionUrl,
                data: formData,
                type: 'POST',
                dataType: 'json',
                success: function (response) {
                    if (response.success) {
                        // handle successful response here
                        alert(response.status);
                    } else {
                        // handle error response here
                        $('#response').html(response.message);
                    }
                },
                error: function () {
                    // handle ajax error here
                }
            });


        });
    });

    function generateTable(body, data) {
        for (let element of data) {
            let row = body.insertRow();
            for (let key in element) {
                let cell = row.insertCell();
                switch (key) {
                    case 'thumbnail':
                        let img = document.createElement('img');
                        img.src = element[key];
                        img.width = 100;
                        img.height = 100;
                        cell.appendChild(img);
                        break;
                    case 'url':
                        let a = document.createElement('a');
                        let link = document.createTextNode('Go to Product Page');
                        a.appendChild(link);
                        a.title = 'Go to Product Page.';
                        a.href = element[key];
                        a.target = '_blank';
                        cell.appendChild(a);
                        break;
                    case 'price':
                        let price = document.createTextNode(parseFloat(element[key]).toFixed(2));
                        cell.appendChild(price);
                        break
                    default:
                        let text = document.createTextNode(element[key]);
                        cell.appendChild(text);
                }
            }
        }
    }

    function submitForm($, url) {

        $('#submit-btn').click(function (event) {
            alert("testeeee");


        });
    }

</script>
